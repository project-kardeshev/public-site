import{r as c,u as v,j as e,N as I,n as S,_ as V,g as w,a as z,e as C,S as A,L as l,b as p,s as j,A as E,l as T}from"./index-faMTddyj.js";import{T as N}from"./index-BAt5Spju.js";import{D as M,a as P,S as $}from"./common-DAma6tjC.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d=new Error().stack;d&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[d]="738b653b-124e-4e05-b11f-de2a7b9748d8",n._sentryDebugIdIdentifier="sentry-dbid-738b653b-124e-4e05-b11f-de2a7b9748d8")}catch{}})();function K({visible:n,setVisibility:d,proposalId:t}){const[s,a]=c.useState("yay"),[f,r]=c.useState(0),{kardBalance:u,aoDataProvider:o}=v(),[i,h]=c.useState(!1);function b(){d(!1)}async function m(){try{h(!0);const x=await o.vote({proposalId:t,vote:s,stakeAmount:f});S.emit("info","Vote submitted, Transaction ID: "+x)}catch(x){console.error(x)}finally{h(!1),b()}}if(!n)return e.jsx(e.Fragment,{});if(!i)return e.jsx("div",{className:"absolute left-0 top-0 z-50 flex size-full items-center justify-center bg-black/75 bg-opacity-50","data-test-id":"vote-modal-container",children:e.jsxs("div",{className:"flex size-1/2 flex-col rounded-lg border-2 border-control-secondary bg-surface-secondary p-4","data-test-id":"vote-modal-container",children:[e.jsxs("h1",{className:"flex w-full justify-center p-4 text-2xl",children:["Vote ",e.jsx("span",{className:`${s==="nay"?"text-error":"text-success"}`,children:s})]}),e.jsxs("div",{className:"border-box flex size-full flex-col justify-center gap-5",children:[e.jsxs("div",{className:"flex size-full flex-row gap-5",children:[e.jsx("button",{onClick:()=>a("yay"),className:`w-full rounded-lg border-2 border-text-secondary bg-background/75 p-2 text-4xl hover:border-success hover:text-success ${s==="yay"?"text-success":""}`,children:"Yay"}),e.jsx("button",{onClick:()=>a("nay"),className:`w-full rounded-lg border-2 border-text-secondary bg-background/75 p-2 text-4xl hover:border-error  hover:text-error ${s==="nay"?"text-error":""}`,children:"Nay"})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("span",{className:"w-full",children:["STAKE ",f," $KARD FOR ",e.jsx("span",{className:s==="yay"?"text-success":"text-error",children:s})]}),e.jsx(I,{value:f,setValue:x=>r(x),placeholder:"Stake Amount",min:0,max:u,step:1})]})]}),e.jsxs("div",{className:"flex w-full flex-row items-center justify-between gap-5 p-2","data-test-id":"vote-modal-controls",children:[u<1?e.jsx("span",{className:"text-error",children:"Insufficient $KARD balance - mint more"}):e.jsxs("span",{className:"flex items-center justify-center text-text-secondary",children:["$KARD Balance: ",u]}),e.jsxs("div",{className:"flex items-center justify-center gap-5",children:[e.jsx("button",{className:"rounded border-2 border-black/0 bg-control-secondary/10 p-1 text-text-primary/50 hover:border-error/50 hover:bg-surface-secondary hover:text-error/50",onClick:b,"data-test-id":"vote-modal-close-button",children:"Cancel"}),e.jsx("button",{className:`rounded border-2 border-highlight/0 p-1 hover:bg-surface-secondary ${s==="yay"?"bg-success/10 text-success hover:border-highlight  hover:text-highlight":"bg-error/10 text-error hover:border-error"}`,onClick:m,"data-test-id":"vote-modal-close-button",children:"Vote"})]})]})]})})}function R({visible:n,setVisibility:d,proposal:t}){const[s,a]=c.useState(),[f,r]=c.useState(!1),[u,o]=c.useState({yay:0,nay:0}),[i,h]=c.useState(Date.now());c.useEffect(()=>{if(!t)return;const x=document.getElementById("proposal-description");x&&(x.innerHTML=t.description),new V().get(t.author).then(y=>{a(y)}),console.log(t),t&&(o(w(t.votes)),m(t))},[t]);function b(){d(!1)}async function m(x){const y=await z.network.getInfo().then(k=>k.height),D=C(x.deadline,y);h(D)}return n?t?e.jsxs("div",{className:"absolute left-0 top-0 z-50 flex size-full items-center justify-center bg-black/75 bg-opacity-50","data-test-id":"view-proposal-modal-container",children:[e.jsxs("div",{className:"flex size-3/4 flex-col gap-5 rounded-lg border-2 border-control-secondary bg-surface-secondary p-4","data-test-id":"view-proposal-modal-container",children:[e.jsx("h1",{className:"flex w-full justify-center p-4 text-2xl",children:t.title}),e.jsxs("div",{className:"border-box flex size-full flex-row items-center justify-center gap-5",children:[e.jsx("div",{className:"size-full rounded bg-surface-primary p-2",id:"proposal-description"}),e.jsx("div",{className:"h-full w-2/5 rounded bg-surface-primary p-2",children:e.jsxs(l,{children:[e.jsx(l.Item,{children:e.jsx(l.Item.Meta,{title:"ID",description:e.jsx(p,{to:`https://arscan.io/tx/${t.id}`,target:"_blank",children:j(t.id)})})}),e.jsx(l.Item,{children:e.jsx(l.Item.Meta,{title:"Author",description:e.jsxs(p,{to:`https://arscan.io/address/${t.author}`,target:"_blank",children:[(s==null?void 0:s.profile.handleName)??j(t.author)," ",e.jsx(E,{src:s==null?void 0:s.profile.avatarURL})]})})}),e.jsx(l.Item,{children:e.jsx(l.Item.Meta,{title:"Votes",description:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Yay: ",u.yay," | Nay: ",u.nay]}),e.jsx("button",{onClick:()=>r(!0),className:"rounded bg-control-secondary p-1 text-text-primary hover:bg-surface-secondary hover:text-highlight",children:"Vote"})]})})}),e.jsx(l.Item,{children:e.jsx(l.Item.Meta,{title:"Status",description:e.jsx(N,{color:t.status==="active"?"green":"red",children:t.status})})}),e.jsx(l.Item,{children:e.jsx(l.Item.Meta,{title:`Estimated Deadline [block ${t.deadline}]`,description:new Date(i).toDateString()})})]})})]}),e.jsx("div",{className:"flex w-full flex-row justify-end gap-5","data-test-id":"view-proposal-modal-controls",children:e.jsx("button",{className:"w-full rounded border-2 border-black/0 bg-control-secondary/10 p-1 text-text-primary/50 hover:border-error/50 hover:bg-surface-secondary hover:text-error/50",onClick:b,"data-test-id":"view-proposal-modal-close-button",children:"Close"})})]}),e.jsx(K,{visible:f,setVisibility:r,proposalId:t.id})]}):e.jsxs("div",{className:"absolute left-0 top-0 z-50 flex size-full items-center justify-center bg-black/75 bg-opacity-50","data-test-id":"create-proposal-modal-container",children:[" ",e.jsx(A,{size:200})," "]}):e.jsx(e.Fragment,{})}const _=[{title:"Proposal 1",id:"0x123".padEnd(43,"0"),description:"This is a proposal",votes:{["b".padEnd(43,"1")]:{yay:1,nay:0}},status:"active",author:"7waR8v4STuwPnTck1zFVkQqJh5K9q9Zik4Y5-5dV7nk",deadline:Date.now()}];function g(n,d){const t=["title","id","votes","status","action"];return Object.keys({...n,action:""}).map((a,f)=>{if(t.includes(a))return new P({key:f.toString(),title:T.startCase(a),dataIndex:a,render:(r,u)=>{switch(a){case"title":return r;case"id":return j(r);case"votes":{const o=w(r);return e.jsxs("span",{children:["yay: ",o==null?void 0:o.yay," | nay: ",o==null?void 0:o.nay]})}case"status":return e.jsx($,{children:e.jsx(N,{color:r==="active"?"green":"red",children:r})});case"action":return e.jsx("button",{className:"rounded bg-control-secondary p-1 text-text-primary hover:bg-surface-secondary hover:text-highlight",onClick:()=>d(u),children:"View"});default:return r}}})}).filter(a=>a!==void 0)}function F(){const{aoDataProvider:n}=v(),[d,t]=c.useState(!1),[s,a]=c.useState(),[f,r]=c.useState("dao-proposals"+Date.now());function u(){r("dao-proposals"+Date.now())}const o=async()=>{const i=await n.getProposals();return Object.entries(i).map(([b,m])=>({id:b,...m}))};return e.jsxs(e.Fragment,{children:[e.jsx(M,{columnGenerator:i=>g(i,h=>{a(h),t(!0)}),defaultColumns:g(_[0],i=>{a(i),t(!0)}),requestCacheKey:f,dataFetcher:o}),e.jsx(R,{visible:d,setVisibility:i=>{i||a(void 0),t(i),u()},proposal:s})]})}function B(){return e.jsxs("div",{className:"flex size-full flex-col",children:[e.jsxs("div",{className:"flex w-full flex-row justify-between p-2",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xl text-text-secondary",children:"DAO"})}),e.jsx("div",{})]}),e.jsx(F,{})]})}export{B as default};
//# sourceMappingURL=Dao-hl4EJWzE.js.map
